TARGET = $(subst .dll,.so,$(SHLIB))

# Ensure .cargo/bin is in PATH for Rstudio/R sessions
export PATH := $(HOME)/.cargo/bin:$(PATH)

# Rust output directory
RUST_DIR = rust
RUST_TARGET_DIR = $(RUST_DIR)/target/release
STATLIB = $(RUST_TARGET_DIR)/libptw_rust.a

# Linker flags
PKG_LIBS = -L$(RUST_TARGET_DIR) -lptw_rust -lpthread -ldl

# R builds $(SHLIB) from $(OBJECTS). We define OBJECTS to include our entrypoint.
OBJECTS = entrypoint.o

$(SHLIB): $(STATLIB) $(OBJECTS)

$(STATLIB):
	cd $(RUST_DIR) && cargo build --release --lib

clean:
	rm -Rf $(SHLIB) $(OBJECTS) $(RUST_DIR)/target
